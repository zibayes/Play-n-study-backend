"""Тесты для модуля course_route_functions"""

import unittest
from logic.course_route_functions import *
from data.types import *


TEST_DATA_GET_UNIT_NAME_BY_ID = [
    (Course(content=(json.loads('{\"body\": [{\"name\": \"1\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"test\", \"test_id\": 69}]}], \"unit_counter\": 1}'))), 1, '1'),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"test\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 1}, {\"unit_type\": \"test\", \"test_id\": 66}, {\"unit_type\": \"test\", \"test_id\": 68}, {\"unit_type\": \"test\", \"test_id\": 70}]}], \"unit_counter\": 1}'))), 1, 'test'),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"1\", \"unit_id\": 1, \"tests\": []}, {\"name\": \"example\", \"unit_id\": 2, \"tests\": []}], \"unit_counter\": 2}'))), 2, 'example'),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"1\", \"unit_id\": 1, \"tests\": []}, {\"name\": \"example1\", \"unit_id\": 2, \"tests\": []}, {\"name\": \"example2\", \"unit_id\": 3, \"tests\": []}], \"unit_counter\": 3}'))), 2, 'example1'),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"Пример\", \"unit_id\": 1, \"tests\": []}, {\"name\": \"example1\", \"unit_id\": 2, \"tests\": []}, {\"name\": \"example2\", \"unit_id\": 3, \"tests\": []}], \"unit_counter\": 3}'))), 1, 'Пример'),
]

TEST_DATA_GET_UNIT_NAME = [
    (Course(content=(json.loads('{\"body\": [{\"name\": \"1\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"test\", \"test_id\": 69}]}], \"unit_counter\": 1}'))), 69, 'test', '1'),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"test\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 1}, {\"unit_type\": \"test\", \"test_id\": 66}, {\"unit_type\": \"test\", \"test_id\": 68}, {\"unit_type\": \"test\", \"test_id\": 70}]}], \"unit_counter\": 1}'))), 68, 'test', 'test'),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"1\", \"unit_id\": 1, \"tests\": []}, {\"name\": \"example\", \"unit_id\": 2, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 22}]}], \"unit_counter\": 2}'))), 22, 'forum', 'example'),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"example\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 23}]}, {\"name\": \"example1\", \"unit_id\": 2, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 22}]}], \"unit_counter\": 3}'))), 22, 'forum', 'example1'),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"example\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 23}]}, {\"name\": \"example1\", \"unit_id\": 2, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 22}]}], \"unit_counter\": 3}'))), 23, 'forum', 'example'),
]

TEST_DATA_GET_UNIT_ID = [
    (Course(content=(json.loads('{\"body\": [{\"name\": \"1\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"test\", \"test_id\": 69}]}], \"unit_counter\": 1}'))), 69, 'test', 1),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"test\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 1}, {\"unit_type\": \"test\", \"test_id\": 66}, {\"unit_type\": \"test\", \"test_id\": 68}, {\"unit_type\": \"test\", \"test_id\": 70}]}], \"unit_counter\": 1}'))), 68, 'test', 1),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"1\", \"unit_id\": 1, \"tests\": []}, {\"name\": \"example\", \"unit_id\": 2, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 22}]}], \"unit_counter\": 2}'))), 22, 'forum', 2),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"example\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 23}]}, {\"name\": \"example1\", \"unit_id\": 2, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 22}]}], \"unit_counter\": 3}'))), 22, 'forum', 2),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"example\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 23}]}, {\"name\": \"example1\", \"unit_id\": 2, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 22}]}], \"unit_counter\": 3}'))), 23, 'forum', 1),
]

TEST_DATA_GET_TEST = [
    (Test(course_id=0, test_id=0, unit_id=0, content=(TestContent.from_json(("{\"name\": \"\u041f\u0435\u0440\u0435\u0442\u0430\u0441\u043a\u0438\u0432\u0430\u043d\u0438\u0435 \u043c\u0430\u0440\u043a\u0435\u0440\u043e\u0432\", \"questions\": [{\"ask\": \"\u041f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438 \u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043e\u0440\u0433\u0430\u043d\u044b\", \"answers\": [{\"marker\": \"\u041b\u0451\u0433\u043a\u0438\u0435\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"441,204;492,295;470,355;590,417;567,190;522,118;466,90;392,135;364,89;304,119;253,237;247,412;380,356;397,157;450,133;\"}, {\"marker\": \"\u0421\u0435\u0440\u0434\u0446\u0435\", \"figure\": \"\u041e\u043a\u0440\u0443\u0436\u043d\u043e\u0441\u0442\u044c\", \"coordinates\": \"434,282,60\"}, {\"marker\": \"\u041f\u0435\u0447\u0435\u043d\u044c\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"458,480;518,408;425,385;334,397;262,469;273,530;396,485;\"}, {\"marker\": \"\u0416\u0435\u043b\u0443\u0434\u043e\u043a\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"469,531;533,505;557,457;520,413;460,483;387,493;406,527;\"}], \"shuffle\": null, \"correct\": 4, \"score\": 1, \"current_score\": null, \"type\": \"markers_drag\", \"comment\": null, \"file\": \"File-1.png\"}]}")))), (1, False)),
    (Test(course_id=0, test_id=0, unit_id=0, content=(TestContent.from_json(("{\"name\": \"\u041f\u0435\u0440\u0435\u0442\u0430\u0441\u043a\u0438\u0432\u0430\u043d\u0438\u0435 \u043c\u0430\u0440\u043a\u0435\u0440\u043e\u0432\", \"questions\": [{\"ask\": \"\u041f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438 \u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043e\u0440\u0433\u0430\u043d\u044b\", \"answers\": [{\"marker\": \"\u041b\u0451\u0433\u043a\u0438\u0435\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"441,204;492,295;470,355;590,417;567,190;522,118;466,90;392,135;364,89;304,119;253,237;247,412;380,356;397,157;450,133;\"}, {\"marker\": \"\u0421\u0435\u0440\u0434\u0446\u0435\", \"figure\": \"\u041e\u043a\u0440\u0443\u0436\u043d\u043e\u0441\u0442\u044c\", \"coordinates\": \"434,282,60\"}, {\"marker\": \"\u041f\u0435\u0447\u0435\u043d\u044c\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"458,480;518,408;425,385;334,397;262,469;273,530;396,485;\"}, {\"marker\": \"\u0416\u0435\u043b\u0443\u0434\u043e\u043a\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"469,531;533,505;557,457;520,413;460,483;387,493;406,527;\"}], \"shuffle\": null, \"correct\": 4, \"score\": 3, \"current_score\": null, \"type\": \"markers_drag\", \"comment\": null, \"file\": \"File-1.png\"}]}")))), (3, False)),
    (Test(course_id=0, test_id=0, unit_id=0, content=(TestContent.from_json(("{\"name\": \"\u041f\u0435\u0440\u0435\u0442\u0430\u0441\u043a\u0438\u0432\u0430\u043d\u0438\u0435 \u043c\u0430\u0440\u043a\u0435\u0440\u043e\u0432\", \"questions\": [{\"ask\": \"\u041f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438 \u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043e\u0440\u0433\u0430\u043d\u044b\", \"answers\": [{\"marker\": \"\u041b\u0451\u0433\u043a\u0438\u0435\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"441,204;492,295;470,355;590,417;567,190;522,118;466,90;392,135;364,89;304,119;253,237;247,412;380,356;397,157;450,133;\"}, {\"marker\": \"\u0421\u0435\u0440\u0434\u0446\u0435\", \"figure\": \"\u041e\u043a\u0440\u0443\u0436\u043d\u043e\u0441\u0442\u044c\", \"coordinates\": \"434,282,60\"}, {\"marker\": \"\u041f\u0435\u0447\u0435\u043d\u044c\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"458,480;518,408;425,385;334,397;262,469;273,530;396,485;\"}, {\"marker\": \"\u0416\u0435\u043b\u0443\u0434\u043e\u043a\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"469,531;533,505;557,457;520,413;460,483;387,493;406,527;\"}], \"shuffle\": null, \"correct\": 4, \"score\": 5, \"current_score\": 3, \"type\": \"markers_drag\", \"comment\": null, \"file\": \"File-1.png\"}]}")))), (5, True)),
    (Test(course_id=0, test_id=0, unit_id=0, content=(TestContent.from_json(("{\"name\": \"\u041f\u0435\u0440\u0435\u0442\u0430\u0441\u043a\u0438\u0432\u0430\u043d\u0438\u0435 \u043c\u0430\u0440\u043a\u0435\u0440\u043e\u0432\", \"questions\": [{\"ask\": \"\u041f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438 \u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043e\u0440\u0433\u0430\u043d\u044b\", \"answers\": [{\"marker\": \"\u041b\u0451\u0433\u043a\u0438\u0435\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"441,204;492,295;470,355;590,417;567,190;522,118;466,90;392,135;364,89;304,119;253,237;247,412;380,356;397,157;450,133;\"}, {\"marker\": \"\u0421\u0435\u0440\u0434\u0446\u0435\", \"figure\": \"\u041e\u043a\u0440\u0443\u0436\u043d\u043e\u0441\u0442\u044c\", \"coordinates\": \"434,282,60\"}, {\"marker\": \"\u041f\u0435\u0447\u0435\u043d\u044c\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"458,480;518,408;425,385;334,397;262,469;273,530;396,485;\"}, {\"marker\": \"\u0416\u0435\u043b\u0443\u0434\u043e\u043a\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"469,531;533,505;557,457;520,413;460,483;387,493;406,527;\"}], \"shuffle\": null, \"correct\": 4, \"score\": 8, \"current_score\": 8, \"type\": \"markers_drag\", \"comment\": null, \"file\": \"File-1.png\"}]}")))), (8, True)),
    (Test(course_id=0, test_id=0, unit_id=0, content=(TestContent.from_json(("{\"name\": \"1\", \"questions\": [{\"ask\": \"1\", \"answers\": [{\"marker\": \"1\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"738,-1;730,648;1032,636;1033,3;\"}, {\"marker\": \"11\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"17,90;17,408;734,378;724,175;\"}], \"shuffle\": null, \"correct\": 2, \"score\": 1, \"current_score\": null, \"type\": \"markers_drag\", \"comment\": null, \"file\": \"File-1.png\"}, {\"ask\": \"2\", \"answers\": [{\"marker\": \"2\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"50,1;37,265;426,249;413,5;\"}, {\"marker\": \"22\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"805,155;797,270;933,248;908,165;\"}], \"shuffle\": null, \"correct\": 2, \"score\": 1, \"current_score\": null, \"type\": \"markers_drag\", \"comment\": null, \"file\": \"File-2.png\"}]}")))), (2, False)),
    (Test(course_id=0, test_id=0, unit_id=0, content=(TestContent.from_json(("{\"name\": \"1\", \"questions\": [{\"ask\": \"1\", \"answers\": [{\"marker\": \"1\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"738,-1;730,648;1032,636;1033,3;\"}, {\"marker\": \"11\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"17,90;17,408;734,378;724,175;\"}], \"shuffle\": null, \"correct\": 2, \"score\": 1, \"current_score\": 0, \"type\": \"markers_drag\", \"comment\": null, \"file\": \"File-1.png\"}, {\"ask\": \"2\", \"answers\": [{\"marker\": \"2\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"50,1;37,265;426,249;413,5;\"}, {\"marker\": \"22\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"805,155;797,270;933,248;908,165;\"}], \"shuffle\": null, \"correct\": 2, \"score\": 1, \"current_score\": 1, \"type\": \"markers_drag\", \"comment\": null, \"file\": \"File-2.png\"}]}")))), (2, True)),
    (Test(course_id=0, test_id=0, unit_id=0, content=(TestContent.from_json(("{\"name\": \"1\", \"questions\": [{\"ask\": \"1\", \"answers\": [{\"marker\": \"1\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"738,-1;730,648;1032,636;1033,3;\"}, {\"marker\": \"11\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"17,90;17,408;734,378;724,175;\"}], \"shuffle\": null, \"correct\": 2, \"score\": 1, \"current_score\": 0, \"type\": \"markers_drag\", \"comment\": null, \"file\": \"File-1.png\"}, {\"ask\": \"2\", \"answers\": [{\"marker\": \"2\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"50,1;37,265;426,249;413,5;\"}, {\"marker\": \"22\", \"figure\": \"\u041c\u043d\u043e\u0433\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\", \"coordinates\": \"805,155;797,270;933,248;908,165;\"}], \"shuffle\": null, \"correct\": 2, \"score\": 3, \"current_score\": 1, \"type\": \"markers_drag\", \"comment\": null, \"file\": \"File-2.png\"}]}")))), (4, True)),
]

TEST_DATA_GET_COURSE_SUMMARY = [
    (Course(content=(json.loads('{\"body\": [{\"name\": \"1\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"test\", \"test_id\": 69}]}], \"unit_counter\": 1}'))), 69, 'test', 1),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"test\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 1}, {\"unit_type\": \"test\", \"test_id\": 66}, {\"unit_type\": \"test\", \"test_id\": 68}, {\"unit_type\": \"test\", \"test_id\": 70}]}], \"unit_counter\": 1}'))), 68, 'test', 1),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"1\", \"unit_id\": 1, \"tests\": []}, {\"name\": \"example\", \"unit_id\": 2, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 22}]}], \"unit_counter\": 2}'))), 22, 'forum', 2),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"example\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 23}]}, {\"name\": \"example1\", \"unit_id\": 2, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 22}]}], \"unit_counter\": 3}'))), 22, 'forum', 2),
    (Course(content=(json.loads('{\"body\": [{\"name\": \"example\", \"unit_id\": 1, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 23}]}, {\"name\": \"example1\", \"unit_id\": 2, \"tests\": [{\"unit_type\": \"forum\", \"test_id\": 22}]}], \"unit_counter\": 3}'))), 23, 'forum', 1),
]


class TestCourseRouteFunctions(unittest.TestCase):
    """Тест-кейс модуля course_route_functions"""
    def test_get_unit_name_by_id(self):
        """Тест функции get_unit_name_by_id"""
        for course, unit_id, expected in TEST_DATA_GET_UNIT_NAME_BY_ID:
            with self.subTest():
                self.assertEqual(get_unit_name_by_id(course, unit_id), expected)

    def test_get_unit_name(self):
        """Тест функции get_unit_name_by_id"""
        for course, task_id, task_type, expected in TEST_DATA_GET_UNIT_NAME:
            with self.subTest():
                self.assertEqual(get_unit_name(course, task_id, task_type), expected)

    def test_get_unit_id(self):
        """Тест функции get_unit_id"""
        for course, task_id, task_type, expected in TEST_DATA_GET_UNIT_ID:
            with self.subTest():
                self.assertEqual(get_unit_id(course, task_id, task_type), expected)

    def test_get_test(self):
        """Тест функции get_test"""
        for test, expected in TEST_DATA_GET_TEST:
            with self.subTest():
                self.assertEqual(get_test(test, True), expected)

    def test_get_course_summary(self):
        """Тест функции get_test"""
        for test, expected in TEST_DATA_GET_TEST:
            with self.subTest():
                self.assertEqual(get_test(test, True), expected)
